<template><div><h2 id="第1章-flask-快速入门" tabindex="-1"><a class="header-anchor" href="#第1章-flask-快速入门" aria-hidden="true">#</a> 第1章 flask 快速入门</h2>
<h3 id="_1-1-flask简介" tabindex="-1"><a class="header-anchor" href="#_1-1-flask简介" aria-hidden="true">#</a> 1.1 <strong>flask简介</strong></h3>
<p>Flask 是典型的微框架，它仅保留了核心功能：请求响应处理和模板渲染。</p>
<p>这两类功能分别由 Werkzeug 和 Jinja 完成。</p>
<p>Flask 内置了这两个依赖。</p>
<p>项目结构</p>
<div class="language-text ext-text line-numbers-mode"><pre v-pre class="language-text"><code>├── .flaskenv
├── app.py
├── test_watchlist.py
├── static
│   ├── favicon.ico
│   ├── images
│   │   ├── avatar.png
│   │   └── totoro.gif
│   └── style.css
└── templates
    ├── 400.html
    ├── 404.html
    ├── 500.html
    ├── base.html
    ├── edit.html
    ├── index.html
    ├── login.html
    └── settings.html
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>
<h3 id="_1-2-安装" tabindex="-1"><a class="header-anchor" href="#_1-2-安装" aria-hidden="true">#</a> 1.2 安装</h3>
<p>pip3 install flask</p>
<h3 id="_1-3-第一个项目" tabindex="-1"><a class="header-anchor" href="#_1-3-第一个项目" aria-hidden="true">#</a> 1.3 <strong>第一个项目</strong></h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token comment"># 路由装饰器</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'Welcome to My Watchlist!'</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
  	<span class="token keyword">print</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>url_map<span class="token punctuation">)</span> <span class="token comment"># 查看所有url映射</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4-编辑模板" tabindex="-1"><a class="header-anchor" href="#_1-4-编辑模板" aria-hidden="true">#</a> 1.4 编辑模板</h3>
<p>pycharm -&gt; settings -&gt; editor -&gt; live emplates -&gt; flask -&gt; quickflask</p>
<p>修改 template text -&gt; 只应用于python文件 -&gt; apply -&gt; ok</p>
<h2 id="第2章-路由" tabindex="-1"><a class="header-anchor" href="#第2章-路由" aria-hidden="true">#</a> 第2章 路由</h2>
<h3 id="_2-1-url-地址动态传参" tabindex="-1"><a class="header-anchor" href="#_2-1-url-地址动态传参" aria-hidden="true">#</a> 2.1 url 地址动态传参</h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> escape
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/user/&lt;int:age>'</span><span class="token punctuation">)</span>  <span class="token comment"># 必须要传入一个int类型的age参数</span>
<span class="token keyword">def</span> <span class="token function">user_page</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">'User: %s'</span> <span class="token operator">%</span> escape<span class="token punctuation">(</span>age<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-自定义路由匹配规则" tabindex="-1"><a class="header-anchor" href="#_2-2-自定义路由匹配规则" aria-hidden="true">#</a> 2.2 自定义路由匹配规则</h3>
<p>给定的路由匹配规则不够灵活</p>
<p>定义类 MyRegexConverter 继承 BaseConverter</p>
<p>app.url_map.converters[&quot;name&quot;] = MyRegexConverter</p>
<h3 id="_2-3-请求方法" tabindex="-1"><a class="header-anchor" href="#_2-3-请求方法" aria-hidden="true">#</a> 2.3 请求方法</h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/path"</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token string">"POST"</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-4-响应结果" tabindex="-1"><a class="header-anchor" href="#_2-4-响应结果" aria-hidden="true">#</a> 2.4 响应结果</h3>
<p>响应 字符串</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">return</span> <span class="token string">"ok"</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>响应 字符串+状态码</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">return</span> <span class="token string">"ok"</span><span class="token punctuation">,</span><span class="token number">200</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>响应 字符串+状态码+响应头</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">return</span> <span class="token string">"ok"</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span><span class="token string">"application/json"</span><span class="token punctuation">,</span><span class="token string">"name"</span><span class="token punctuation">:</span><span class="token string">"myname"</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>响应 json</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"wl"</span> <span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">}</span>
<span class="token keyword">return</span> jsonify<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>响应 重定向</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">"https://www.baidu.com"</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>响应 url_for 反解析</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"taobao"</span><span class="token punctuation">,</span>token<span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-5-异常跳转" tabindex="-1"><a class="header-anchor" href="#_2-5-异常跳转" aria-hidden="true">#</a> 2.5 异常跳转</h3>
<p>定义异常处理函数</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>errorhandler</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">page_not_found</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token string">"404页面"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>手动模拟异常</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  abort<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token string">"helloworld"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-request" tabindex="-1"><a class="header-anchor" href="#_2-6-request" aria-hidden="true">#</a> 2.6 request</h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>request
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span>  <span class="token comment"># 输出请求结果</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>  <span class="token comment"># 请求url</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">)</span>  <span class="token comment"># 获取所有参数</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 安全获取某个参数</span>
  
  <span class="token keyword">return</span> <span class="token string">"helloworld"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-7-运行配置" tabindex="-1"><a class="header-anchor" href="#_2-7-运行配置" aria-hidden="true">#</a> 2.7 运行配置</h3>
<p>从配置类中加载</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Myconfig</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  	DEBUG<span class="token operator">=</span><span class="token boolean">True</span>
    
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_object<span class="token punctuation">(</span>Myconfig<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从配置文件中加载</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code>app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_pyfile<span class="token punctuation">(</span><span class="token string">"config.ini"</span><span class="token punctuation">)</span>

<span class="token operator">//</span>config<span class="token punctuation">.</span>ini
DEBUG<span class="token operator">=</span><span class="token boolean">True</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从环境变量中加载</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code>app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_envvar<span class="token punctuation">(</span>env<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-8-请求钩子" tabindex="-1"><a class="header-anchor" href="#_2-8-请求钩子" aria-hidden="true">#</a> 2.8 请求钩子</h3>
<p>before_first_request 在处理第一个请求前执行, 并且始终执行一次</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 适合做初始化操作, 如io文件读写</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_first_request</span>
<span class="token keyword">def</span> <span class="token function">before_first_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"before_first_request"</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>before_request 在每次请求前执行</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 适合对请求参数做校验,访问统计</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>before_request</span>
<span class="token keyword">def</span> <span class="token function">before_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  	<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"before_request"</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>after_request 请求后执行, 没有错误的情况下</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 适合对返回值作统一处理, 如返回统一的json数据格式</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>after_request</span>
<span class="token keyword">def</span> <span class="token function">after_request</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">:</span>
  	resp<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">"Content-Type"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"application/json"</span>
    <span class="token keyword">return</span> resp
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>teardown_request 请求后执行</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 请求销毁后执行, 适合做异常信息统计</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>teardown_request</span>
<span class="token keyword">def</span> <span class="token function">teardown_request</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">:</span>
  	<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-9-cookie" tabindex="-1"><a class="header-anchor" href="#_2-9-cookie" aria-hidden="true">#</a> 2.9 cookie</h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> request

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/setcookie"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">set_cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  	response <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">"setcookie"</span><span class="token punctuation">)</span>
    response<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">"com"</span><span class="token punctuation">,</span><span class="token string">"baidu"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response
  
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/getcookie"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_cookie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  	name <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"com"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> name
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-10-session" tabindex="-1"><a class="header-anchor" href="#_2-10-session" aria-hidden="true">#</a> 2.10 session</h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> session

<span class="token comment">#设置秘钥</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">[</span><span class="token string">"SECRET_KEY"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"asldjhalhdjlka"</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/setsession/&lt;name>"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">set_session</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
  	session<span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token operator">=</span> name
    <span class="token keyword">return</span> <span class="token string">"ok"</span>
  
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/getsession"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  	value <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> name
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-11-上下文" tabindex="-1"><a class="header-anchor" href="#_2-11-上下文" aria-hidden="true">#</a> 2.11 上下文</h3>
<p>current_app  是app的一个代理对象</p>
<p>g 一个局部的全局变量</p>
<h3 id="_2-12-flask脚本" tabindex="-1"><a class="header-anchor" href="#_2-12-flask脚本" aria-hidden="true">#</a> 2.12 flask脚本</h3>
<p>安装</p>
<p>pip install flask_script</p>
<p>导入</p>
<p>from flask_script import Manager</p>
<p>manager = Manager(app)</p>
<p>入口函数</p>
<p>manager.run()  # 不能传参数</p>
<p>启动</p>
<p>python <a href="http://main.py" target="_blank" rel="noopener noreferrer">main.py<ExternalLinkIcon/></a> runserver</p>
<p>可选参数</p>
<p>-h 127.0.0.1</p>
<p>-p 5000</p>
<p>-d (开启debug模式)</p>
<h2 id="第3章-jinja2模板" tabindex="-1"><a class="header-anchor" href="#第3章-jinja2模板" aria-hidden="true">#</a> 第3章 jinja2模板</h2>
<h3 id="_3-1-模板语法" tabindex="-1"><a class="header-anchor" href="#_3-1-模板语法" aria-hidden="true">#</a> 3.1 模板语法</h3>
<p><code v-pre>{{ pass }}</code> 用来标记变量。</p>
<p><code v-pre>{% pass %}</code> 用来标记语句，比如 if 语句，for 语句等。</p>
<p><code v-pre>{# pass #}</code> 用来写注释。</p>
<p>if 判断</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> username <span class="token punctuation">}</span><span class="token punctuation">}</span>的个人主页<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> bio <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> bio <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>  <span class="token punctuation">{</span><span class="token comment"># 这里的缩进只是为了可读性，不是必须的 #}</span>
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">else</span> <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>p<span class="token operator">></span>自我介绍为空。<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token comment"># 大部分 Jinja 语句都需要声明关闭 #}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>for 循环</p>
<div class="language-jinja2 ext-jinja2 line-numbers-mode"><pre v-pre class="language-jinja2"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
        <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">for</span> <span class="token variable">movie</span> <span class="token keyword">in</span> <span class="token variable">movies</span> <span class="token delimiter punctuation">%}</span></span>  <span class="token jinja2 language-jinja2"><span class="token comment">{# 迭代 movies 变量 #}</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token variable">movie</span><span class="token punctuation">.</span><span class="token variable">title</span> <span class="token delimiter punctuation">}}</span></span> - <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token variable">movie</span><span class="token punctuation">.</span><span class="token variable">year</span> <span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  
          <span class="token jinja2 language-jinja2"><span class="token comment">{# 等同于 movie['title'] #}</span></span>
        <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endfor</span> <span class="token delimiter punctuation">%}</span></span>  <span class="token jinja2 language-jinja2"><span class="token comment">{# 使用 endfor 标签结束 for 语句 #}</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-渲染模板" tabindex="-1"><a class="header-anchor" href="#_3-2-渲染模板" aria-hidden="true">#</a> 3.2 渲染模板</h3>
<p>templates/index.html：主页模板</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">></span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span>
	<span class="token operator">&lt;</span>head<span class="token operator">></span>
  	  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">></span>
 	   <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span>'s Watchlist<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
	<span class="token operator">&lt;</span>body<span class="token operator">></span>
   	 <span class="token operator">&lt;</span>h2<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span>'s Watchlist<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
   	 <span class="token punctuation">{</span><span class="token comment"># 使用 length 过滤器获取 movies 变量的长度 #}</span>
     <span class="token operator">&lt;</span>p<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> movies<span class="token operator">|</span>length <span class="token punctuation">}</span><span class="token punctuation">}</span> Titles<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>
     <span class="token operator">&lt;</span>ul<span class="token operator">></span>
        <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> movie <span class="token keyword">in</span> movies <span class="token operator">%</span><span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token comment"># 迭代 movies 变量 #}</span>
        <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> movie<span class="token punctuation">.</span>title <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">-</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> movie<span class="token punctuation">.</span>year <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>  
          <span class="token punctuation">{</span><span class="token comment"># 等同于 movie['title'] #}</span>
        <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>  <span class="token punctuation">{</span><span class="token comment"># 使用 endfor 标签结束 for 语句 #}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
          
    <span class="token operator">&lt;</span>footer<span class="token operator">></span>
        <span class="token operator">&lt;</span>small<span class="token operator">></span><span class="token operator">&amp;</span>copy<span class="token punctuation">;</span> <span class="token number">2018</span> 
          <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"http://helloflask.com/tutorial"</span><span class="token operator">></span>
          HelloFlask<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>small<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">></span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="http://app.py" target="_blank" rel="noopener noreferrer">app.py<ExternalLinkIcon/></a>：定义虚拟数据</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code>name <span class="token operator">=</span> <span class="token string">'Grey Li'</span>
movies <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'My Neighbor Totoro'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'1988'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Dead Poets Society'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'1989'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'A Perfect World'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'1993'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Leon'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'1994'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Mahjong'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'1996'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Swallowtail Butterfly'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'1996'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'King of Comedy'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'1999'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'Devils on the Doorstep'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'1999'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'WALL-E'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'2008'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> <span class="token string">'The Pork of Music'</span><span class="token punctuation">,</span> <span class="token string">'year'</span><span class="token punctuation">:</span> <span class="token string">'2012'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>渲染主页模板</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/parmas'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index_parmas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> name<span class="token operator">=</span>name<span class="token punctuation">,</span> age<span class="token operator">=</span>age<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-传值和接收" tabindex="-1"><a class="header-anchor" href="#_3-3-传值和接收" aria-hidden="true">#</a> 3.3 传值和接收</h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/parmas'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index_parmas</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  	name <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
    age <span class="token operator">=</span> <span class="token number">18</span>
    <span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{</span> year<span class="token punctuation">:</span><span class="token number">1988</span><span class="token punctuation">,</span> month<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">}</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> name<span class="token operator">=</span>name<span class="token punctuation">,</span> age<span class="token operator">=</span>age<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-jinja2 ext-jinja2 line-numbers-mode"><pre v-pre class="language-jinja2"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token variable">name</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token variable">age</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token variable">dict</span><span class="token punctuation">.</span><span class="token variable">year</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token variable">dict</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token string">"month"</span><span class="token punctuation">]</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 注意不加引号会把month解释为变量 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4-系统过滤器" tabindex="-1"><a class="header-anchor" href="#_3-4-系统过滤器" aria-hidden="true">#</a> 3.4 系统过滤器</h3>
<p>系统字符串过滤器</p>
<div class="language-jinja2 ext-jinja2 line-numbers-mode"><pre v-pre class="language-jinja2"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token string">"HELLO"</span> <span class="token operator">|</span> <span class="token variable">lower</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 把值转化成小写
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token string">"HELLO"</span> <span class="token operator">|</span> <span class="token variable">title</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 每个单词首字母都大写
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token string">"HELLO"</span> <span class="token operator">|</span> <span class="token variable">upper</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 每个单词都大写
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token string">"HELLO"</span> <span class="token operator">|</span> <span class="token variable">reverse</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 反转

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token string">"HELLO"</span> <span class="token operator">|</span> <span class="token variable">upper</span> <span class="token operator">|</span> <span class="token variable">reverse</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 链式调用
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>系统列表过滤器</p>
<div class="language-jinja2 ext-jinja2 line-numbers-mode"><pre v-pre class="language-jinja2"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token variable">first</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 取第一个元素
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token variable">last</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 取最后一个元素
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token variable">length</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 获取列表长度
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token variable">sum</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 求和
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token variable">sort</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>  # 升序排序
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-自定义过滤器" tabindex="-1"><a class="header-anchor" href="#_3-5-自定义过滤器" aria-hidden="true">#</a> 3.5 自定义过滤器</h3>
<p><a href="http://main.py" target="_blank" rel="noopener noreferrer">main.py<ExternalLinkIcon/></a></p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>

<span class="token comment"># 1. 创建求偶数和逻辑的函数 不使用注解方式</span>
<span class="token keyword">def</span> <span class="token function">get_evensum</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">sum</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">:</span>
      <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">:</span>
        <span class="token builtin">sum</span> <span class="token operator">+=</span> i
    <span class="token keyword">return</span> <span class="token builtin">sum</span>
  
<span class="token comment"># 把求偶数和函数关联到过滤器evensum</span>
app<span class="token punctuation">.</span>add_template_filter<span class="token punctuation">(</span>get_evensum<span class="token punctuation">,</span><span class="token string">"evensum"</span><span class="token punctuation">)</span>  


<span class="token comment"># 2. 创建反转列表的函数  使用注解直接创建</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>add_template_filter</span><span class="token punctuation">(</span><span class="token string">"lreverse"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">list_reverse</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token builtin">list</span><span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">list</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>templates/index.html</p>
<div class="language-jinja2 ext-jinja2 line-numbers-mode"><pre v-pre class="language-jinja2"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token variable">evensum</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>  # 结果为6
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span> <span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token operator">|</span> <span class="token variable">sort</span> <span class="token operator">|</span> <span class="token variable">lreverse</span> <span class="token delimiter punctuation">}}</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>  # 结果为 [8,6,5,3,2]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-宏" tabindex="-1"><a class="header-anchor" href="#_3-6-宏" aria-hidden="true">#</a> 3.6 宏</h3>
<div class="language-jinja2 ext-jinja2 line-numbers-mode"><pre v-pre class="language-jinja2"><code><span class="token jinja2 language-jinja2"><span class="token comment">{# 定义宏 #}</span></span>
<span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">macro</span> <span class="token function">mymacro</span><span class="token punctuation">(</span><span class="token variable">name</span><span class="token punctuation">,</span><span class="token variable">password</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%}</span></span>
	用户名: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span><span class="token variable">name</span><span class="token delimiter punctuation">}}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
	密码: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span><span class="token variable">password</span><span class="token delimiter punctuation">}}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
<span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endmacro</span> <span class="token delimiter punctuation">%}</span></span>

<span class="token jinja2 language-jinja2"><span class="token comment">{# 调用当前文件内的宏 #}</span></span>
<span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token function">mymacro</span><span class="token punctuation">(</span><span class="token string">"zangsan"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span>

<span class="token jinja2 language-jinja2"><span class="token comment">{# 调用其他文件里的宏 #}</span></span>
<span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">import</span> <span class="token string">'xxx.html'</span> <span class="token keyword">as</span> <span class="token variable">other</span>  <span class="token delimiter punctuation">%}</span></span>
<span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{{</span> <span class="token variable">other</span><span class="token punctuation">.</span><span class="token function">mydiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">}}</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>xxx.html</p>
<div class="language-jinja2 ext-jinja2 line-numbers-mode"><pre v-pre class="language-jinja2"><code><span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">macro</span> <span class="token function">mydiv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token delimiter punctuation">%}</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>我是另一个文件中的宏<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token jinja2 language-jinja2"><span class="token delimiter punctuation">{%</span> <span class="token tag keyword">endmacro</span> <span class="token delimiter punctuation">%}</span></span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7-继承" tabindex="-1"><a class="header-anchor" href="#_3-7-继承" aria-hidden="true">#</a> 3.7 继承</h3>
<h3 id="_3-8-包含" tabindex="-1"><a class="header-anchor" href="#_3-8-包含" aria-hidden="true">#</a> 3.8 包含</h3>
<h3 id="_3-9-模板特有变量" tabindex="-1"><a class="header-anchor" href="#_3-9-模板特有变量" aria-hidden="true">#</a> 3.9 模板特有变量</h3>
<p>app.config</p>
<p>request</p>
<p>g</p>
<p>url_for()</p>
<p>get_flashed_messages()</p>
<h3 id="_3-10-csrf-跨站请求伪造" tabindex="-1"><a class="header-anchor" href="#_3-10-csrf-跨站请求伪造" aria-hidden="true">#</a> 3.10 csrf 跨站请求伪造</h3>
<p>csrf攻击</p>
<p>csrf project</p>
<p>pip install flask-wtf</p>
<h2 id="第4章-静态文件" tabindex="-1"><a class="header-anchor" href="#第4章-静态文件" aria-hidden="true">#</a> 第4章 静态文件</h2>
<h3 id="_4-1-添加图片" tabindex="-1"><a class="header-anchor" href="#_4-1-添加图片" aria-hidden="true">#</a> 4.1 <strong>添加图片</strong></h3>
<p>templates/index.html：添加图片</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token operator">&lt;</span>h2<span class="token operator">></span>
    <span class="token operator">&lt;</span>img alt<span class="token operator">=</span><span class="token string">"Avatar"</span> src<span class="token operator">=</span><span class="token string">"{{ url_for('static', filename='images/avatar.png') }}"</span><span class="token operator">></span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span>'s Watchlist
<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">&lt;</span>img alt<span class="token operator">=</span><span class="token string">"Walking Totoro"</span> src<span class="token operator">=</span><span class="token string">"{{ url_for('static', filename='images/totoro.gif') }}"</span><span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr>
<h3 id="_4-2-添加css" tabindex="-1"><a class="header-anchor" href="#_4-2-添加css" aria-hidden="true">#</a> 4.2 <strong>添加css</strong></h3>
<p>static/style.css：定义页面样式</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token operator">/</span><span class="token operator">*</span> 页面整体 <span class="token operator">*</span><span class="token operator">/</span>
body <span class="token punctuation">{</span>
    margin<span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
    <span class="token builtin">max</span><span class="token operator">-</span>width<span class="token punctuation">:</span> 580px<span class="token punctuation">;</span>
    font<span class="token operator">-</span>size<span class="token punctuation">:</span> 14px<span class="token punctuation">;</span>
    font<span class="token operator">-</span>family<span class="token punctuation">:</span> Helvetica<span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans<span class="token operator">-</span>serif<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>templates/index.html：引入 CSS 文件</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token operator">&lt;</span>head<span class="token operator">></span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"{{ url_for('static', filename='style.css') }}"</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text/css"</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第5章-数据库" tabindex="-1"><a class="header-anchor" href="#第5章-数据库" aria-hidden="true">#</a> 第5章 数据库</h2>
<h3 id="_5-1-orm-对象关系映射模型" tabindex="-1"><a class="header-anchor" href="#_5-1-orm-对象关系映射模型" aria-hidden="true">#</a> 5.1 ORM 对象关系映射模型</h3>
<p>不需要编写sql语句</p>
<p>不关注使用的是哪种关系数据库</p>
<p>会有时间上的损耗</p>
<h3 id="_5-2-安装数据库模块" tabindex="-1"><a class="header-anchor" href="#_5-2-安装数据库模块" aria-hidden="true">#</a> 5.2 <strong>安装数据库模块</strong></h3>
<p><strong>安装Flask - SQLAlchemy</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>pip3 <span class="token function">install</span> flask-sqlalchemy
pip3 <span class="token function">install</span> pymysql 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>使用数据库模块</strong></p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> create_engine<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> String
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>ext<span class="token punctuation">.</span>declarative <span class="token keyword">import</span> declarative_base
<span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>orm <span class="token keyword">import</span> sessionmaker

<span class="token comment"># app入口</span>
app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token comment"># 数据库连接</span>
engine <span class="token operator">=</span> create_engine
<span class="token punctuation">(</span><span class="token string">'mysql+pymysql://root:wangle2018@127.0.0.1:3306/studyflask'</span><span class="token punctuation">,</span> echo<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
session_maker <span class="token operator">=</span> sessionmaker<span class="token punctuation">(</span>bind<span class="token operator">=</span>engine<span class="token punctuation">)</span>
session <span class="token operator">=</span> session_maker<span class="token punctuation">(</span><span class="token punctuation">)</span>
Base <span class="token operator">=</span> declarative_base<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 数据库模型</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">'student'</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> Column<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> Column<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
		
    <span class="token comment"># 重写打印方法</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'&lt;Student(id:%s, name:%s)>'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>



<span class="token comment"># 查询所有学生</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 若存在STUDENT表则不做，不存在则创建。</span>
    Base<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span>engine<span class="token punctuation">)</span>
    <span class="token comment"># 查询所有student学生</span>
    queryObject <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">.</span>desc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> ins <span class="token keyword">in</span> queryObject<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ins<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> ins<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"ok"</span>
  
  
<span class="token comment"># 添加一条记录</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/insert'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    stu1 <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span>
    <span class="token comment"># 新增一个学生</span>
    session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>stu1<span class="token punctuation">)</span>
    session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"ok"</span>


<span class="token comment"># 入口函数</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3-创建模型" tabindex="-1"><a class="header-anchor" href="#_5-3-创建模型" aria-hidden="true">#</a> 5.3 <strong>创建模型</strong></h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 数据库模型</span>
<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span>Base<span class="token punctuation">)</span><span class="token punctuation">:</span>
    __tablename__ <span class="token operator">=</span> <span class="token string">'student'</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> Column<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    name <span class="token operator">=</span> Column<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
		
    <span class="token comment"># 重写打印方法</span>
    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'&lt;Student(id:%s, name:%s)>'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-4-增删改" tabindex="-1"><a class="header-anchor" href="#_5-4-增删改" aria-hidden="true">#</a> 5.4 增删改</h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 添加单个对象</span>
session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>  

<span class="token comment"># 添加多个对象</span>
session<span class="token punctuation">.</span>add_all<span class="token punctuation">(</span><span class="token punctuation">[</span>obj1<span class="token punctuation">,</span>obj2<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 删除单个对象</span>
session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>

<span class="token comment"># 提交会话</span>
session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 回滚</span>
session<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 移除会话</span>
session<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-5-基本查询" tabindex="-1"><a class="header-anchor" href="#_5-5-基本查询" aria-hidden="true">#</a> 5.5 基本查询</h3>
<p>完整代码</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment">#  / 路由 查询所有学生</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 若存在STUDENT表则不做，不存在则创建。</span>
    Base<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>create_all<span class="token punctuation">(</span>engine<span class="token punctuation">)</span>
    <span class="token comment"># 查询所有student学生</span>
    queryObject <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">.</span>desc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> ins <span class="token keyword">in</span> queryObject<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ins<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> ins<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token keyword">return</span> queryObject
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>常用查询公式</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 查询所有用户数据</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询10条用户数据</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span>limit<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询有多少个用户</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询第1个用户</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询id为4的用户[3种方式]</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token operator">==</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询名字结尾字符为g的所有数据[开始/包含]</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询名字不等于wang的所有数据</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span>name<span class="token operator">!=</span><span class="token string">'wang'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询名字和邮箱都以i开头的所有数据[2种方法]</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		Student<span class="token punctuation">.</span>email<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>and_<span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		Student<span class="token punctuation">.</span>email<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'g'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询 password 是123456或者 email以 itheima.com结尾的所有数据</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>or_<span class="token punctuation">(</span>Student<span class="token punctuation">.</span>password <span class="token operator">==</span><span class="token string">'123456'</span><span class="token punctuation">,</span>		Student<span class="token punctuation">.</span>email<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'itheima.com'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询id为[1,3,5,7,9]的用户列表</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">.</span>in_<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询name为liu的角色数据</span>
student <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Student<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'liu'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Role<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Role<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> user<span class="token punctuation">.</span>role_id<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查询所有用户数据，并以邮箱排序</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>Student<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>Student<span class="token punctuation">.</span>email<span class="token punctuation">.</span>desc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 每页3个，查询第2页的数据</span>
paginate <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Student<span class="token punctuation">)</span>
		<span class="token punctuation">.</span>paginate<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment"># 2代表查询第二页的内容, 3代表每页有3个数据</span>

paginate<span class="token punctuation">.</span>pages <span class="token comment"># 输出总页数</span>
paginate<span class="token punctuation">.</span>page <span class="token comment"># 输在当前在第几页</span>
paginate<span class="token punctuation">.</span>items <span class="token comment"># 输出当前页的所有数据</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-6-关系查询" tabindex="-1"><a class="header-anchor" href="#_5-6-关系查询" aria-hidden="true">#</a> 5.6 关系查询</h3>
<p>作用 : 解决两表联查需要写很多过滤器的问题</p>
<p>需求 : 查询所有角色为admin的所有学生</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 1.先在Role表中定义虚拟键</span>
users <span class="token operator">=</span> relationship<span class="token punctuation">(</span><span class="token string">"Student"</span><span class="token punctuation">)</span>

<span class="token comment"># 2.查询admin角色</span>
role <span class="token operator">=</span> Role<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 1对象的admin</span>

<span class="token comment"># 3.获取列表</span>
user_list <span class="token operator">=</span> role<span class="token punctuation">.</span>users
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-7-反向查询" tabindex="-1"><a class="header-anchor" href="#_5-7-反向查询" aria-hidden="true">#</a> 5.7 反向查询</h3>
<p>作用 : 解决两表联查需要写很多过滤器的问题</p>
<p>需求 : 知道一个学生的情况下, 查询到他的角色</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 1.先在Role表中定义虚拟键 加上backref属性</span>
users <span class="token operator">=</span> relationship<span class="token punctuation">(</span><span class="token string">"Student"</span><span class="token punctuation">,</span> backref<span class="token operator">=</span><span class="token string">"role"</span><span class="token punctuation">)</span>

<span class="token comment"># 2.查询admin角色</span>
user <span class="token operator">=</span> Student<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 3.获取列表</span>
role_list <span class="token operator">=</span> user<span class="token punctuation">.</span>role
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-8-懒查询" tabindex="-1"><a class="header-anchor" href="#_5-8-懒查询" aria-hidden="true">#</a> 5.8 懒查询</h3>
<p><strong>作用</strong> : 解决关系查询和反向查询带来的效率问题</p>
<p><strong>子查询(subquery)</strong> : 查询出了一方, 就会自动将关联的一方查询出来(默认)</p>
<p><strong>动态查询(dynamic)</strong> : 只有用到了才去查询</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 在Role表中定义虚拟键 加上lazy属性 不加默认为subquery模式</span>
users <span class="token operator">=</span> relationship<span class="token punctuation">(</span><span class="token string">"Student"</span><span class="token punctuation">,</span> backref<span class="token operator">=</span><span class="token string">"role"</span><span class="token punctuation">,</span>lazy<span class="token operator">=</span><span class="token string">"dynamic"</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-9-接入redis数据库" tabindex="-1"><a class="header-anchor" href="#_5-9-接入redis数据库" aria-hidden="true">#</a> 5.9 接入redis数据库</h3>
<p>启动 redis</p>
<p>redis-server /usr/local/redis/redis.conf</p>
<p>安装缓存模块</p>
<p>pip3 install flask_cache</p>
<p>开启配置</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">import</span> Flask <span class="token keyword">from</span> flask 
<span class="token keyword">import</span> Cache <span class="token keyword">from</span> flask_cache 
cache <span class="token operator">=</span> Cache<span class="token punctuation">(</span><span class="token punctuation">)</span>

config <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'CACHE_TYPE'</span><span class="token punctuation">:</span> <span class="token string">'redis'</span><span class="token punctuation">,</span>
  <span class="token string">'CACHE_REDIS_HOST'</span><span class="token punctuation">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
  <span class="token string">'CACHE_REDIS_PORT'</span><span class="token punctuation">:</span> <span class="token number">6379</span><span class="token punctuation">,</span>
  <span class="token string">'CACHE_REDIS_DB'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token string">'CACHE_REDIS_PASSWORD'</span><span class="token punctuation">:</span> <span class="token string">''</span>
<span class="token punctuation">}</span>

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>from_object<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
cache<span class="token punctuation">.</span>init_app<span class="token punctuation">(</span>app<span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@cache<span class="token punctuation">.</span>cached</span><span class="token punctuation">(</span>timeout<span class="token operator">=</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  name <span class="token operator">=</span> <span class="token string">'mink'</span>
  <span class="token keyword">return</span> name

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
  app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第6章-权限框架" tabindex="-1"><a class="header-anchor" href="#第6章-权限框架" aria-hidden="true">#</a> 第6章 权限框架</h2>
<h3 id="_6-1-原生的登录注册" tabindex="-1"><a class="header-anchor" href="#_6-1-原生的登录注册" aria-hidden="true">#</a> 6.1 原生的登录注册</h3>
<p><strong>1. 典型的表单</strong></p>
<div class="language-html ext-html line-numbers-mode"><pre v-pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>{{ movies|length }} Titles<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    Name <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">></span></span>
    Year <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>year<span class="token punctuation">"</span></span> <span class="token attr-name">autocomplete</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>off<span class="token punctuation">"</span></span> <span class="token attr-name">required</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Add<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. 处理表单数据</strong></p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask <span class="token keyword">import</span> request<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> flash

<span class="token comment"># ...</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>  <span class="token comment"># 判断是否是 POST 请求</span>
        <span class="token comment"># 获取表单数据</span>
        title <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span>  <span class="token comment"># 传入表单对应输入字段的 name 值</span>
        year <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'year'</span><span class="token punctuation">)</span>
        <span class="token comment"># 验证数据</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> title <span class="token keyword">or</span> <span class="token keyword">not</span> year <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">4</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">60</span><span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">'Invalid input.'</span><span class="token punctuation">)</span>  <span class="token comment"># 显示错误提示</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 重定向回主页</span>
        <span class="token comment"># 保存表单数据到数据库</span>
        movie <span class="token operator">=</span> Movie<span class="token punctuation">(</span>title<span class="token operator">=</span>title<span class="token punctuation">,</span> year<span class="token operator">=</span>year<span class="token punctuation">)</span>  <span class="token comment"># 创建记录</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>add<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>  <span class="token comment"># 添加到数据库会话</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 提交数据库会话</span>
        flash<span class="token punctuation">(</span><span class="token string">'Item created.'</span><span class="token punctuation">)</span>  <span class="token comment"># 显示成功创建的提示</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 重定向回主页</span>

    movies <span class="token operator">=</span> Movie<span class="token punctuation">.</span>query<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> movies<span class="token operator">=</span>movies<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>3. 用户认证模块</strong></p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ pip <span class="token function">install</span> flask-login
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>4. 初始化 Flask-L</strong>ogin</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># app.py</span>
<span class="token keyword">from</span> flask_login <span class="token keyword">import</span> LoginManager

login_manager <span class="token operator">=</span> LoginManager<span class="token punctuation">(</span>app<span class="token punctuation">)</span>  <span class="token comment"># 实例化扩展类</span>

<span class="token decorator annotation punctuation">@login_manager<span class="token punctuation">.</span>user_loader</span>
<span class="token keyword">def</span> <span class="token function">load_user</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 创建用户加载回调函数，接受用户 ID 作为参数</span>
    user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 用 ID 作为 User 模型的主键查询对应的用户</span>
    <span class="token keyword">return</span> user  <span class="token comment"># 返回用户对象</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>存储用户的 User 模型类继承 UserMixin 类</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask_login <span class="token keyword">import</span> UserMixin

<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>Model<span class="token punctuation">,</span> UserMixin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="http://app.py" target="_blank" rel="noopener noreferrer">app.py<ExternalLinkIcon/></a>：用户登录</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask_login <span class="token keyword">import</span> login_user

<span class="token comment"># ...</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> username <span class="token keyword">or</span> <span class="token keyword">not</span> password<span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">'Invalid input.'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        user <span class="token operator">=</span> User<span class="token punctuation">.</span>query<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 验证用户名和密码是否一致</span>
        <span class="token keyword">if</span> username <span class="token operator">==</span> user<span class="token punctuation">.</span>username <span class="token keyword">and</span> user<span class="token punctuation">.</span>validate_password<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>
            login_user<span class="token punctuation">(</span>user<span class="token punctuation">)</span>  <span class="token comment"># 登入用户</span>
            flash<span class="token punctuation">(</span><span class="token string">'Login success.'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 重定向到主页</span>

        flash<span class="token punctuation">(</span><span class="token string">'Invalid username or password.'</span><span class="token punctuation">)</span>  <span class="token comment"># 如果验证失败，显示错误消息</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 重定向回登录页面</span>

    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>templates/login.html：登录页面</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token punctuation">{</span><span class="token operator">%</span> extends <span class="token string">'base.html'</span> <span class="token operator">%</span><span class="token punctuation">}</span>

<span class="token punctuation">{</span><span class="token operator">%</span> block content <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>h3<span class="token operator">></span>Login<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
<span class="token operator">&lt;</span>form method<span class="token operator">=</span><span class="token string">"post"</span><span class="token operator">></span>
    Username<span class="token operator">&lt;</span>br<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"username"</span> required<span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span>
    Password<span class="token operator">&lt;</span>br<span class="token operator">></span>
    <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> 密码输入框的 <span class="token builtin">type</span> 属性使用 password，会将输入值显示为圆点 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"password"</span> name<span class="token operator">=</span><span class="token string">"password"</span> required<span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span><span class="token operator">&lt;</span>br<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"btn"</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"submit"</span> name<span class="token operator">=</span><span class="token string">"submit"</span> value<span class="token operator">=</span><span class="token string">"Submit"</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token operator">%</span> endblock <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用户登出</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask_login <span class="token keyword">import</span> login_required<span class="token punctuation">,</span> logout_user

<span class="token comment"># ...</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>  <span class="token comment"># 用于视图保护，后面会详细介绍</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    logout_user<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 登出用户</span>
    flash<span class="token punctuation">(</span><span class="token string">'Goodbye.'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 重定向回首页</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>认证保护</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/movie/delete/&lt;int:movie_id>'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>  <span class="token comment"># 登录保护</span>
<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>movie_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    movie <span class="token operator">=</span> Movie<span class="token punctuation">.</span>query<span class="token punctuation">.</span>get_or_404<span class="token punctuation">(</span>movie_id<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>movie<span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
    flash<span class="token punctuation">(</span><span class="token string">'Item deleted.'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code>login_manager<span class="token punctuation">.</span>login_view <span class="token operator">=</span> <span class="token string">'login'</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/movie/edit/&lt;int:movie_id>'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>movie_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask_login <span class="token keyword">import</span> login_required<span class="token punctuation">,</span> current_user

<span class="token comment"># ...</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> current_user<span class="token punctuation">.</span>is_authenticated<span class="token punctuation">:</span>  <span class="token comment"># 如果当前用户未认证</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 重定向到主页</span>
        <span class="token comment"># ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="http://app.py" target="_blank" rel="noopener noreferrer">app.py<ExternalLinkIcon/></a>：支持设置用户名字</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">from</span> flask_login <span class="token keyword">import</span> login_required<span class="token punctuation">,</span> current_user

<span class="token comment"># ...</span>

<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/settings'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@login_required</span>
<span class="token keyword">def</span> <span class="token function">settings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        name <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>

        <span class="token keyword">if</span> <span class="token keyword">not</span> name <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">20</span><span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">'Invalid input.'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'settings'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        current_user<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        <span class="token comment"># current_user 会返回当前登录用户的数据库记录对象</span>
        <span class="token comment"># 等同于下面的用法</span>
        <span class="token comment"># user = User.query.first()</span>
        <span class="token comment"># user.name = name</span>
        db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        flash<span class="token punctuation">(</span><span class="token string">'Settings updated.'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'settings.html'</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>templates/settings.html：设置页面模板</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token punctuation">{</span><span class="token operator">%</span> extends <span class="token string">'base.html'</span> <span class="token operator">%</span><span class="token punctuation">}</span>

<span class="token punctuation">{</span><span class="token operator">%</span> block content <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>h3<span class="token operator">></span>Settings<span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span>
<span class="token operator">&lt;</span>form method<span class="token operator">=</span><span class="token string">"post"</span><span class="token operator">></span>
    Your Name <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"name"</span> autocomplete<span class="token operator">=</span><span class="token string">"off"</span> required value<span class="token operator">=</span><span class="token string">"{{ current_user.name }}"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"btn"</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"submit"</span> name<span class="token operator">=</span><span class="token string">"submit"</span> value<span class="token operator">=</span><span class="token string">"Save"</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token operator">%</span> endblock <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>模板内容保护
index.html</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> 在模板中可以直接使用 current_user 变量 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">></span>
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>form method<span class="token operator">=</span><span class="token string">"post"</span><span class="token operator">></span>
    Name <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"title"</span> autocomplete<span class="token operator">=</span><span class="token string">"off"</span> required<span class="token operator">></span>
    Year <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"year"</span> autocomplete<span class="token operator">=</span><span class="token string">"off"</span> required<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"btn"</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"submit"</span> name<span class="token operator">=</span><span class="token string">"submit"</span> value<span class="token operator">=</span><span class="token string">"Add"</span><span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"btn"</span> href<span class="token operator">=</span><span class="token string">"{{ url_for('edit', movie_id=movie.id) }}"</span><span class="token operator">></span>Edit<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>
    <span class="token operator">&lt;</span>form <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"inline-form"</span> method<span class="token operator">=</span><span class="token string">"post"</span> action<span class="token operator">=</span><span class="token string">"{{ url_for('.delete', movie_id=movie.id) }}"</span><span class="token operator">></span>
        <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"btn"</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"submit"</span> name<span class="token operator">=</span><span class="token string">"delete"</span> value<span class="token operator">=</span><span class="token string">"Delete"</span> onclick<span class="token operator">=</span><span class="token string">"return confirm('Are you sure?')"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> current_user<span class="token punctuation">.</span>is_authenticated <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"{{ url_for('settings') }}"</span><span class="token operator">></span>Settings<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
    <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"{{ url_for('logout') }}"</span><span class="token operator">></span>Logout<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">else</span> <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"{{ url_for('login') }}"</span><span class="token operator">></span>Login<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
<span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-flask-security" tabindex="-1"><a class="header-anchor" href="#_6-2-flask-security" aria-hidden="true">#</a> 6.2 flask-security</h3>
<h2 id="第7章-蓝图和单元测试" tabindex="-1"><a class="header-anchor" href="#第7章-蓝图和单元测试" aria-hidden="true">#</a> 第7章 蓝图和单元测试</h2>
<h3 id="_7-1-蓝图独立使用" tabindex="-1"><a class="header-anchor" href="#_7-1-蓝图独立使用" aria-hidden="true">#</a> 7.1 蓝图独立使用</h3>
<p>作用 : 方便模块化开发</p>
<p><a href="http://demo.py" target="_blank" rel="noopener noreferrer">demo.py<ExternalLinkIcon/></a></p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 创建蓝图对象</span>
<span class="token keyword">import</span> Blueprint <span class="token keyword">from</span> flask
<span class="token comment"># blue才是真正的变量,myblue字段只用做打印区分,无意义</span>
blue <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">"myblue"</span><span class="token punctuation">,</span>__name__<span class="token punctuation">)</span>  

<span class="token comment">#使用蓝图装饰视图函数</span>
<span class="token decorator annotation punctuation">@blue<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">return</span> <span class="token string">"hello"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="http://main.py" target="_blank" rel="noopener noreferrer">main.py<ExternalLinkIcon/></a></p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token comment"># 将蓝图注册到app中</span>
<span class="token keyword">import</span> blue <span class="token keyword">from</span> demo<span class="token punctuation">.</span>py
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>blue<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-蓝图-包的使用" tabindex="-1"><a class="header-anchor" href="#_7-2-蓝图-包的使用" aria-hidden="true">#</a> 7.2 蓝图 包的使用</h3>
<p><strong>作用:</strong> 每个蓝图都可以有自己的模板文件, 静态文件, 配置文件等</p>
<p><strong>为什么使用包 而不是是文件夹?</strong> 因为包有初始化文件 <code v-pre>__init__.py</code></p>
<p><code v-pre>user/__init__.py</code></p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">import</span> Blueprint <span class="token keyword">from</span> flask

<span class="token comment"># __name__ 固定参数 必须这么写</span>
<span class="token comment"># static_folder 该蓝图的静态文件夹位置  </span>
<span class="token comment"># template_folder 该蓝图的模板文件夹位置</span>
<span class="token comment"># url_prefix 与根目录的静态文件区分</span>

user_blue <span class="token operator">=</span> Blueprint<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span>__name__<span class="token punctuation">,</span>
                   static_folder<span class="token operator">=</span><span class="token string">"static"</span><span class="token punctuation">,</span>
                      url_prefix<span class="token operator">=</span><span class="token string">"/user"</span><span class="token punctuation">,</span>
                      template_folder<span class="token operator">=</span><span class="token string">"templates"</span><span class="token punctuation">)</span>  

<span class="token comment"># 导入的顺序必须是这样, 不然导致循环导包 </span>
<span class="token keyword">import</span> views <span class="token keyword">from</span> user
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>user/views.py</code></p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">import</span> user_blue <span class="token keyword">from</span> user
<span class="token decorator annotation punctuation">@user_blue<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">return</span> <span class="token string">"hello"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code v-pre>main.py</code></p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">import</span> Flask <span class="token keyword">from</span> flask
<span class="token keyword">import</span> user_blue <span class="token keyword">from</span> user
app<span class="token operator">=</span>Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>register_blueprint<span class="token punctuation">(</span>user_blue<span class="token punctuation">)</span>
if__name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
  app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-循环导包" tabindex="-1"><a class="header-anchor" href="#_7-3-循环导包" aria-hidden="true">#</a> 7.3 循环导包</h3>
<p><strong>概念 :</strong> 两个文件之间相互引用, 并且导入的顺序不对, 导致程序循环导包</p>
<p><img src="@source/document/python全栈/asset/image-20220411114815869-9648899.png" alt="image-20220411114815869" loading="lazy"></p>
<h3 id="_7-4-断言" tabindex="-1"><a class="header-anchor" href="#_7-4-断言" aria-hidden="true">#</a> 7.4 断言</h3>
<p><strong>定义</strong> : 判断程序执行到某个地方, 能否达到预期效果</p>
<p><strong>应用</strong> : 单元测试 , 开发框架</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">dis_num</span><span class="token punctuation">(</span>num1<span class="token punctuation">,</span>num2<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>nun1<span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"num1必须为整数"</span>  
  <span class="token keyword">return</span> num1<span class="token operator">/</span>num2

<span class="token comment"># num1为不期待的结果,会抛出异常,日志信息会很清楚</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dis_num<span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-5-单元测试" tabindex="-1"><a class="header-anchor" href="#_7-5-单元测试" aria-hidden="true">#</a> 7.5 单元测试</h3>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">sayhello</span><span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> to<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'Hello, %s!'</span> <span class="token operator">%</span> to
    <span class="token keyword">return</span> <span class="token string">'Hello!'</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>单元测试</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> hello <span class="token keyword">import</span> sayhello

<span class="token keyword">class</span> <span class="token class-name">SayHelloTestCase</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 测试用例</span>
    <span class="token keyword">def</span> <span class="token function">setUp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 测试固件</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">tearDown</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 测试固件</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">test_sayhello</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 第1个测试,方法必须以test开头</span>
        rv <span class="token operator">=</span> sayhello<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>rv<span class="token punctuation">,</span> <span class="token string">'Hello!'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_sayhello_to_somebody</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 第 2 个测试</span>
        rv <span class="token operator">=</span> sayhello<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Grey'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>rv<span class="token punctuation">,</span> <span class="token string">'Hello, Grey!'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    unittest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="第8章-部署上线" tabindex="-1"><a class="header-anchor" href="#第8章-部署上线" aria-hidden="true">#</a> 第8章 部署上线</h2>
<p>生成依赖列表</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ pip freeze <span class="token operator">></span> requirements.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>安装依赖列表</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>$ pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用 manger 管理后部署</p>
<div class="language-bash ext-sh line-numbers-mode"><pre v-pre class="language-bash"><code>python manager.py runserver <span class="token parameter variable">--host</span> <span class="token number">0.0</span>.0.0 <span class="token parameter variable">--port</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="第9章-此笔记相关信息" tabindex="-1"><a class="header-anchor" href="#第9章-此笔记相关信息" aria-hidden="true">#</a> 第9章 此笔记相关信息</h2>
<h3 id="参考视频连接" tabindex="-1"><a class="header-anchor" href="#参考视频连接" aria-hidden="true">#</a> 参考视频连接</h3>
<p><a href="https://www.bilibili.com/video/BV1Lf4y117PS?p=77&amp;spm_id_from=pageDriver" target="_blank" rel="noopener noreferrer">https://www.bilibili.com/video/BV1Lf4y117PS?p=77&amp;spm_id_from=pageDriver<ExternalLinkIcon/></a></p>
<h3 id="待完成项目" tabindex="-1"><a class="header-anchor" href="#待完成项目" aria-hidden="true">#</a> 待完成项目</h3>
<p>6.2 shiro+jwt</p>
</div></template>
